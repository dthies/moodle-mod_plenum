{"version":3,"file":"plenum.min.js","sources":["../src/plenum.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/ //\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/*\n * Plenary meeting main page js\n *\n * @package    mod_plenum\n * @module     mod_plenum/plenum\n * @copyright  2023 Daniel Thies\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Fragment from \"core/fragment\";\nimport Templates from \"core/templates\";\nimport ModalForm from \"core_form/modalform\";\nimport Notification from \"core/notification\";\nimport {get_string as getString} from \"core/str\";\n\nconst SELECTORS = {\n    PREVIEW: '.modal-body [data-region=\"view-motion\"]',\n};\n\nexport default class Plenum {\n    /**\n     * Initialize player plugin\n     *\n     * @param {int} contextid\n     *\n     * @returns {bool}\n     */\n    constructor(contextid) {\n        this.contextid = contextid;\n\n        this.addListeners();\n\n        return true;\n    }\n\n    /**\n     * Register player events to respond to user interaction and play progress.\n     */\n    addListeners() {\n        document.querySelector('body').removeEventListener('click', handleClick);\n        document.querySelector('body').addEventListener('click', handleClick);\n    }\n}\n\n/**\n * Handle click event\n *\n * @param {Event} e Event\n */\nconst handleClick = function(e) {\n    const button = e.target.closest(\n        '[data-region=\"plenum-motions\"][data-contextid] [data-action],'\n        + ' .modal-body [data-region=\"view-motion\"] [data-action],'\n        + ' .modal-body [data-region=\"plenum-activity-report\"][data-contextid] [data-action]'\n    );\n    if (button) {\n        const action = button.getAttribute('data-action'),\n            contextid = button.closest('[data-contextid]').getAttribute('data-contextid');\n        e.stopPropagation();\n        e.preventDefault();\n\n        if (action == 'move') {\n            const type = button.getAttribute('data-type');\n            const modalForm = new ModalForm({\n                args: {\n                    contextid: contextid,\n                    type: button.getAttribute('data-type')\n                },\n                formClass: `plenumtype_${type}\\\\form\\\\edit_motion`,\n                modalConfig: {title: getString('editingmotiontype', `plenumtype_${type}`)}\n            });\n            modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (e) => {\n                const motionCreated = new CustomEvent('motioncreated', {\n                    detail: e.detail\n                });\n                document.body.dispatchEvent(motionCreated);\n            });\n            modalForm.show();\n        } else if (['adopt', 'allow', 'decline', 'deny'].includes(action)) {\n            const id = e.target.closest('[data-motion]').getAttribute('data-motion');\n            const modalForm = new ModalForm({\n                args: {\n                    contextid: contextid,\n                    id: id,\n                    state: action\n                },\n                formClass: 'mod_plenum\\\\form\\\\change_state',\n                modalConfig: {title: getString('confirm')}\n            });\n            modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (e) => {\n                const motionUpdated = new CustomEvent('motionupdated', {\n                    detail: e.detail\n                });\n                document.body.dispatchEvent(motionUpdated);\n            });\n            modalForm.show();\n        } else if (action == 'close') {\n            const id = e.target.closest('[data-motion]').getAttribute('data-motion');\n            const modalForm = new ModalForm({\n                formClass: 'mod_plenum\\\\form\\\\close_motion',\n                args: {contextid: contextid, id: id, state: action}\n            });\n            modalForm.addEventListener(modalForm.events.FORM_SUBMITTED, (e) => {\n                const motionUpdated = new CustomEvent('motionupdated', {\n                    detail: e.detail\n                });\n                document.body.dispatchEvent(motionUpdated);\n            });\n            modalForm.show();\n        } else if (action == 'preview') {\n            const id = e.target.closest('[data-motion]').getAttribute('data-motion');\n            Fragment.loadFragment(\n                'mod_plenum',\n                'motion',\n                contextid,\n                {id: id}\n            ).done((html) => {\n                if (button.closest(SELECTORS.PREVIEW)) {\n                    Templates.replaceNodeContents(button.closest(SELECTORS.PREVIEW), html);\n                } else {\n                    Notification.alert(getString('viewmotion', 'mod_plenum'), html);\n                }\n            }).fail(Notification.exeption);\n        }\n    }\n};\n"],"names":["SELECTORS","constructor","contextid","addListeners","document","querySelector","removeEventListener","handleClick","addEventListener","e","button","target","closest","action","getAttribute","stopPropagation","preventDefault","type","modalForm","ModalForm","args","formClass","modalConfig","title","events","FORM_SUBMITTED","motionCreated","CustomEvent","detail","body","dispatchEvent","show","includes","id","state","motionUpdated","loadFragment","done","html","replaceNodeContents","alert","fail","Notification","exeption"],"mappings":";;;;;;;;uRA6BMA,kBACO,iEAWTC,YAAYC,uBACHA,UAAYA,eAEZC,gBAEE,EAMXA,eACIC,SAASC,cAAc,QAAQC,oBAAoB,QAASC,aAC5DH,SAASC,cAAc,QAAQG,iBAAiB,QAASD,qBAS3DA,YAAc,SAASE,SACnBC,OAASD,EAAEE,OAAOC,QACpB,4MAIAF,OAAQ,OACFG,OAASH,OAAOI,aAAa,eAC/BZ,UAAYQ,OAAOE,QAAQ,oBAAoBE,aAAa,qBAChEL,EAAEM,kBACFN,EAAEO,iBAEY,QAAVH,OAAkB,OACZI,KAAOP,OAAOI,aAAa,aAC3BI,UAAY,IAAIC,mBAAU,CAC5BC,KAAM,CACFlB,UAAWA,UACXe,KAAMP,OAAOI,aAAa,cAE9BO,+BAAyBJ,4BACzBK,YAAa,CAACC,OAAO,mBAAU,yCAAmCN,UAEtEC,UAAUV,iBAAiBU,UAAUM,OAAOC,gBAAiBhB,UACnDiB,cAAgB,IAAIC,YAAY,gBAAiB,CACnDC,OAAQnB,EAAEmB,SAEdxB,SAASyB,KAAKC,cAAcJ,kBAEhCR,UAAUa,YACP,GAAI,CAAC,QAAS,QAAS,UAAW,QAAQC,SAASnB,QAAS,OACzDoB,GAAKxB,EAAEE,OAAOC,QAAQ,iBAAiBE,aAAa,eACpDI,UAAY,IAAIC,mBAAU,CAC5BC,KAAM,CACFlB,UAAWA,UACX+B,GAAIA,GACJC,MAAOrB,QAEXQ,UAAW,iCACXC,YAAa,CAACC,OAAO,mBAAU,cAEnCL,UAAUV,iBAAiBU,UAAUM,OAAOC,gBAAiBhB,UACnD0B,cAAgB,IAAIR,YAAY,gBAAiB,CACnDC,OAAQnB,EAAEmB,SAEdxB,SAASyB,KAAKC,cAAcK,kBAEhCjB,UAAUa,YACP,GAAc,SAAVlB,OAAmB,OACpBoB,GAAKxB,EAAEE,OAAOC,QAAQ,iBAAiBE,aAAa,eACpDI,UAAY,IAAIC,mBAAU,CAC5BE,UAAW,iCACXD,KAAM,CAAClB,UAAWA,UAAW+B,GAAIA,GAAIC,MAAOrB,UAEhDK,UAAUV,iBAAiBU,UAAUM,OAAOC,gBAAiBhB,UACnD0B,cAAgB,IAAIR,YAAY,gBAAiB,CACnDC,OAAQnB,EAAEmB,SAEdxB,SAASyB,KAAKC,cAAcK,kBAEhCjB,UAAUa,YACP,GAAc,WAAVlB,OAAqB,OACtBoB,GAAKxB,EAAEE,OAAOC,QAAQ,iBAAiBE,aAAa,iCACjDsB,aACL,aACA,SACAlC,UACA,CAAC+B,GAAIA,KACPI,MAAMC,OACA5B,OAAOE,QAAQZ,sCACLuC,oBAAoB7B,OAAOE,QAAQZ,mBAAoBsC,4BAEpDE,OAAM,mBAAU,aAAc,cAAeF,SAE/DG,KAAKC,sBAAaC"}