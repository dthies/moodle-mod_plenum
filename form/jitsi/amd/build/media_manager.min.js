define("plenumform_jitsi/media_manager",["exports","core/ajax","plenumform_jitsi/external_api","core/notification","core/templates"],(function(_exports,_ajax,_external_api,_notification,_templates){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/*
   * Plenary meeting Jitsi integration media manager
   *
   * @package    plenumform_jitsi
   * @module     plenumform_jitsi/media_manager
   * @copyright  2023 Daniel Thies
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */var domain,conferenceOptions;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_ajax=_interopRequireDefault(_ajax),_external_api=_interopRequireDefault(_external_api),_notification=_interopRequireDefault(_notification),_templates=_interopRequireDefault(_templates);_exports.default=class{constructor(contextid,delay,server,options){return this.contextid=contextid,options.parentNode=document.querySelector("#meet"),options.contextid=contextid,conferenceOptions=options,domain=server,delay&&setInterval((()=>{this.updateMotions(contextid)}),delay),document.addEventListener("click",handleClick.bind(this)),document.body.addEventListener("motioncreated",(()=>{this.updateMotions(this.contextid),this.api&&this.api.executeCommand("sendEndpointTextMessage","","text")})),document.body.addEventListener("motionupdated",(()=>{this.updateMotions(this.contextid),this.api&&this.api.executeCommand("sendEndpointTextMessage","","text")})),!0}async updateMotions(contextid){const selector='[data-contextid="'.concat(contextid,'"][data-region="plenum-motions"]'),content=document.querySelector(selector);if(content){const response=await _ajax.default.call([{args:{contextid:contextid},contextid:contextid,fail:_notification.default.exception,methodname:"mod_plenum_update_content"}])[0];response.motions&&_templates.default.replaceNodeContents(content,response.motions,response.javascript)}}};const register=function(){return _ajax.default.call([{args:{contextid:Number(conferenceOptions.contextid),join:!0},contextid:conferenceOptions.contextid,fail:_notification.default.exception,methodname:"plenumform_jitsi_join_room"}])[0]},leave=function(){return this.api=null,_ajax.default.call([{args:{contextid:Number(conferenceOptions.contextid),join:!1},contextid:conferenceOptions.contextid,fail:_notification.default.exception,methodname:"plenumform_jitsi_join_room"}])[0]},raiseHand=e=>_ajax.default.call([{args:{contextid:Number(conferenceOptions.contextid),raisehand:!!e.handRaised},contextid:conferenceOptions.contextid,fail:_notification.default.exception,methodname:"plenumform_jitsi_raise_hand"}])[0],handleClick=function(e){const button=e.target.closest('button[data-action="joinroom"]');if(button){const api=new _external_api.default(domain,conferenceOptions);button.parentNode.classList.add("hidden"),conferenceOptions.parentNode.classList.remove("hidden"),api.addListener("readyToClose",(()=>{button.parentNode.classList.remove("hidden"),conferenceOptions.parentNode.classList.add("hidden"),api.dispose()})),api.addListener("videoConferenceJoined",(()=>{register.bind(this),this.api=api})),api.addListener("endpointTextMessageReceived",(()=>{this.updateMotions(this.contextid)})),api.addListener("videoConferenceLeft",leave.bind(this)),api.addListener("raiseHandUpdated",raiseHand)}};return _exports.default}));

//# sourceMappingURL=media_manager.min.js.map